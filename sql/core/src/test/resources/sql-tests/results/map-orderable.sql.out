-- Automatically generated by SQLQueryTestSuite
-- Number of queries: 14


-- !query
CREATE OR REPLACE TEMPORARY VIEW t AS SELECT * FROM VALUES
  (map('a', 1, 'b', 2, 'c', 3)),
  (map('c', 3, 'b', 2, 'a', 1)),
  (map('d', 4)),
  (map('a', 1, 'e', 2)),
  (map('d', 4)),
  (map('d', 5))
  AS v(m)
-- !query schema
struct<>
-- !query output



-- !query
CREATE OR REPLACE TEMPORARY VIEW t2 AS SELECT * FROM VALUES
  (map('b', 2, 'a', 1, 'c', 3))
  AS v(m2)
-- !query schema
struct<>
-- !query output



-- !query
CREATE OR REPLACE TEMPORARY VIEW t3 AS SELECT * FROM VALUES
  (map(map('a', 1, 'b', 2), map('hello', array('i', 'j')))),
  (map(map('b', 1, 'a', 1), map('world', array('o', 'p')))),
  (map(map('b', 2, 'a', 1), map('hello', array('m', 'n')))),
  (map(map('b', 2, 'a', 1), map('hello', array('i', 'j'))))
  AS v(nested_map1)
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
failed to evaluate expression map(map('a', 1, 'b', 2), map('hello', array('i', 'j'))): assertion failed: key of map cannot be/contain map; line 1 pos 53


-- !query
select m, count(1) from t group by m
-- !query schema
struct<m:map<string,int>,count(1):bigint>
-- !query output
{"a":1,"b":2,"c":3}	2
{"a":1,"e":2}	1
{"d":4}	2
{"d":5}	1


-- !query
select m2, count(1), percentile(id, 0.5) from (
  select
    case when size(m) == 3 then m else map('b', 2, 'a', 1, 'c', 3)
    end as m2,
    1 as id
  from t
)
group by m2
-- !query schema
struct<m2:map<string,int>,count(1):bigint,percentile(id, 0.5, 1):double>
-- !query output
{"a":1,"b":2,"c":3}	6	1.0


-- !query
select distinct m from t
-- !query schema
struct<m:map<string,int>>
-- !query output
{"a":1,"b":2,"c":3}
{"a":1,"e":2}
{"d":4}
{"d":5}


-- !query
select distinct m, m2 from t join t2 on t.m = t2.m2
-- !query schema
struct<m:map<string,int>,m2:map<string,int>>
-- !query output
{"a":1,"b":2,"c":3}	{"a":1,"b":2,"c":3}


-- !query
select m from t order by m
-- !query schema
struct<m:map<string,int>>
-- !query output
{"d":4}
{"d":4}
{"d":5}
{"a":1,"e":2}
{"a":1,"b":2,"c":3}
{"a":1,"b":2,"c":3}


-- !query
select m, count(1) over (partition by m) from t
-- !query schema
struct<m:map<string,int>,count(1) OVER (PARTITION BY m ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING):bigint>
-- !query output
{"a":1,"b":2,"c":3}	2
{"a":1,"b":2,"c":3}	2
{"a":1,"e":2}	1
{"d":4}	2
{"d":4}	2
{"d":5}	1


-- !query
select m, m2 from t join t2 on t.m = t2.m2
-- !query schema
struct<m:map<string,int>,m2:map<string,int>>
-- !query output
{"a":1,"b":2,"c":3}	{"a":1,"b":2,"c":3}
{"a":1,"b":2,"c":3}	{"a":1,"b":2,"c":3}


-- !query
select m from t where m = map('b', 2, 'a', 1, 'c', 3)
-- !query schema
struct<m:map<string,int>>
-- !query output
{"a":1,"b":2,"c":3}
{"a":1,"b":2,"c":3}


-- !query
select nested_map, count(1) from t3 group by nested_map
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Table or view not found: t3; line 1 pos 33


-- !query
select distinct nested_map from t3
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Table or view not found: t3; line 1 pos 32


-- !query
select nested_map from t3 order by nested_map
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
Table or view not found: t3; line 1 pos 23
